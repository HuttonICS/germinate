/**************************************************/
/*              GERMINATE 3                       */
/*              CHANGELOG v3.3.0                  */
/**************************************************/


/* CHANGELOG */

  - CHG: Added Filter that makes sure the browser does not cache .nocache files.
  - ADD: Option to show a map below the datasets table (shows associated locations).
  - ADD: Added download link for markers removed from data export.
  - CHG: Major rewrite of main table code. It's now much easier to use.
  - CHG: Rewrite of Google Map Marker Clusterer code.
  - FIX: Fixed accession marking mechanism. Was marking wrong items at times.
  - FIX: Fixed search table highlight hiding anchor element.
  - CHG: Major rewrite of table code. AbstractBaseTable and PaginationTable now use Providers to create and render the cells.
  - ADD: Added another download option to d3.js charts. You can now download the data file that is used to create the chart.
  - ADD: Added trials overview table.
  - ADD: Added trials overview line chart.
  - CHG: Moved linePerformance page to the initial trials page.
  - CHG: Tweaked the web interface template.
  - DEL: Deleted template image files that aren't mission critical -> less images, more or less same look.
  - ADD: Added more width steps to the website template (1280px and 1600px) for higher resolution screens.
  - ADD: Added export option for attributes to main accession export (below the main accession table).
  - ADD: Added dataset description to phenotype export preview table.
  - ADD: <servlet> and <servlet-mapping> entries in web.xml are no longer required.
  - CHG: More template style changes.
  - CHG: Restricted decimal places of numbers to 2 digits where sensible.
  - CHG: Changed share-widget to mirror look-and-feel of new language selector.
  - ADD: Introduced new ShareWidget.java that replaces ShareButtonBar.java.
  - FIX: Fixed multiple CSS issues.
  - FIX: Dataset overview table showing the wrong column content.
  - ADD: Germinate now uses HTML5 local storage instead of cookies (some cookies remain).
  - ADD: Added pedigree database tables.
  - CHG: Updated jQuery to 2.1.4.
  - CHG: Updated jQueryUI to 1.11.4.
  - ADD: Added new properties entry: "Germinate.HideIdColumns" that controls if internal id columns are shown in tables.
  - CHG: Updated httpclient and httpcore to newer versions.
  - CHG: Major rewrite of PaginationTable.
  - ADD: Added initial functionality to handle marking of not only accessions.
  - CHG: Changed RPC signatures to use Pagination.java instead of a variable each for start, length and sorting, etc.
  - CHG: Updated FontAwesome to 4.4.0.
  - CHG: Added more database tables to conform with the MCPD.
  - CHG: Removed no longer required columns from "germinatebase".
  - CHG: Moved "flowering_season_start" and "growing_season_start" to "attributes".
  - ADD: Markers and collecting sites can now be marked for the "shopping cart" as well as accessions.
  - FIX: Fixed issue with floating table headers not loading.
  - CHG: Replaced some raster image resources with vector image resources.
  - CHG: logo.png and crop.png now have to be .svg files.
  - FIX: Fixed issue where Germinate would not undeploy from Tomcat from time to time.
  - CHG: Replaced all paginated tables with new implementation that makes tables more consistent and reusable.
  - ADD: Added pagination to dataset tables.
  - ADD: Introduced caching of database query results to increase performance and decrease the load on the database while still returning up-to-date data.
  - CHG: Removed restrictions for search terms on the groups item filters. Search terms can now include SQL special characters as well.
  - FIX: Fixed issue with the allele frequency data export. Items were exported independent of the dataset that was selected.
  - DEL: Removed table 'groupdatasets' as no longer required.
  - CHG: Rewrote SQL queries formerly using 'groupdatasets' table.
  - CHG: Restyling of d3.js chart options panel.
  - CHG: Changed package structure to reflect new internal guideline.
  - FIX: Fixed an issue with session persistence on the server.
  - ADD: Added "number of data points" to the datasets table.
  - ADD: Added "search" menu item to main menu. This can be disabled/enabled with a config.properties entry ("Germinate.Template.Show.Search").
  - ADD: Added initial table filtering feature.
  - CHG: Changed PassportPage to use the new Accession data object.
  - CHG: Added pagination to the attributes table on the passport page.
  - CHG: Added option to show all locations on the location overview page.
  - ADD: Added "read-only" mode where the user is not allowed to add/delete/update the data in the database. This can be disabled/enabled with a config.properties entry ("Germinate.IsReadOnly").
  - ADD: Added tooltips to shopping cart indicator to explain which number represents which type of marked item.
  - FIX: Fixed an issue where the context menu on markable item tables didn't show up when the actual marker checkbox was right-clicked.
  - ADD: Added option to filter by just the year (in addition to full dates) in filterable tables with date columns.
  - CHG: Disabled help button on pages that do not provide help information.
  - FIX: Fixed multiple theming related issues on mobile devices.
  - ADD: Added functionality to create groups of accessions (more types in the future) from an external software tool. This includes uploading a file with the accession identifiers. The external tool will get the name of the uploaded file in the result and can then forward the user to the Germinate web-interface where the user can review the group preview. If everything looks ok, the user can create a new group.
  - CHG: Removed group editing functionality if user doesn't have permissions to actually edit the group.
  - FIX: Fixed issue with shopping cart context-menu not showing when right-clicking on the actual checkbox column of a markable table.
  - ADD: Added pagination to annotations/comments widget.
  - FIX: Fixed issue with images not properly released on the server which caused Tomcat undeploy issues on Windows.
  - ADD: Added distribution indicator to scatter plots.
  - ADD: Added phenotype/trials location chart. This will show the number of phenotype/trials readings per country. If a phenotype is selected, this will show the average phenotype value per country.
  - FIX: Fixed issue with phenotypic data export. It wouldn't export data for phenotypes that do not have a unit.
  - CHG: It's no longer necessary (and no longer recommended) to bundle your own copy of Flapjack with Germinate. We will now bundle an up to date version of Flapjack with the basic setup.
  - ADD: Added option to mark accessions from phenotype/trials charts.
  - CHG: Rewrite of FileDownloadWidget and OnDemandFileDownloadWidget.
  - FIX: Fixed .kml export.
  - CHG: Made .kml export more efficient and stable.
  - FIX: Fixed issue with duplicate gradient widgets on locations overview page.
  - ADD: Added administrator configuration page (#admin-config).
  - CHG: Complete rewrite of the main navigation menu to allow for sub-menus.
  - ADD: Added option to download data for marked accessions from accessions overview page.
  - FIX: Fixed loading indicator forcing scrollbars on tables when using Firefox.
  - ADD: Added column filtering to Dataset tables.
  - ADD: Added the option to download phenotypic data from the phenotypic dataset overview page (download icon per row).
  - ADD: Added table options panel that allows showing/hiding the table filter headers.
  - CHG: Rewrote table options panels for a more consistant look.
  - FIX: Fixed "Continue" button being visible on genotype-datasets page even if genotype-export isn't available
  - CHG: Improved performance of stored procedure to export germinatebase table for marked accessions.
  - CHG: Right-aligned number columns.
  - ADD: Added "mark all items" to selected tables. This will mark all the items from all pages of the paginated table not just the current page.
  - FIX: Fixed issue with Internet Explorer where it wouldn't accept a specific (valid) jQuery call to open/close the table filter panel.
  - FIX: Fixed file encoding issues when writing climate chart data files.
  - CHG: Better integration of Flapjack by directly calling Flapjack's API for file manipulation instead of running the .jar file externally.
  - ADD: Added "Color by dataset" to phenotype by phenotype charts.
  - ADD: Added collecting site search based on user-defined polygons.
  - ADD: Added units to Climate dropdown box
  - FIX: Fixed issue with wrong items being selected from phenotype by phenotype chart.
  - ADD: Added coloring options to phenotype matrix chart.
  - FIX: Fixed issue with query location moving during query on geographic search page.
  - CHG: Changed positioning of climate overlays on Google Maps.
  - ADD: Added actual minimum and maximum values to Gradient legend.
  - FIX: Fixed issue with maps of wrong type showing up during data export.
  - CHG: Moved "Continue" button above map on datasets page.
  - ADD: Added loading indicators to user input widgets on the groups page.
  - FIX: Fixed issue where non-admin users weren't able to create new groups.


/* MIGRATION */

  - Migrating from 3.2.0d to 3.3.0:

    - Install Java 8 on your server running Tomcat.

    - Delete the "Flapjack" folder in your "instance-stuff/<your-project>/apps" folder.
    
    - The "Text.properties" keys have changed from camel-case notation to dot-separated notation. Please consult the file "3.2.1-properties-mapping.tsv" for a mapping between old and new keys. The "I18NReplacer.java" class can be used to generate a file in the new format based on the old format. Please modify the paths accordingly.

    - Old translatable text has been removed. The following properties can be removed from your "Text.properties" file and the according transoation files:

      column.accessions.growing.season
      column.accessions.flowering.season
      column.passport.contact
      column.passport.status
      column.passport.breeder.submitter
      column.passport.contact.current
      column.passport.phenotype
      column.passport.state.id
      column.passport.state.description
      page.passport.genotype.title
      page.passport.genotype.text
      page.passport.breeder.title
      page.passport.dus.profile.title
      page.passport.passport.additional.title
      column.locations.waterlog
      column.locations.ph

    - New translatable text has been added. The following properties can be changed in your "Text.properties" file and the according translation files:

      banner.read.only=Germinate is currently operating in read-only mode. Some features have been temporarily disabled.
      column.dataset.datapoints=Data points
      column.locations.type.name=Location type
      column.phenotype.data.treatment.description=Treatment
      menu.search=search
      notification.accessions.selection.empty=Please select an accession.
      notification.group.group.name.exists=A group with this name already exists.
      notification.group.preview.invalid.filename=Session invalidated because expected and found group members differ.
      notification.group.preview.name.missing=Name missing.
      notification.groups.items.added.ignored=Items added: {0}, items ignored: {1}.
      notification.system.read.only=Germinate is operating in read-only mode. Changes have not been applied.
      page.group.placeholder.group.name=Group name
      page.group.preview.add.button=Add group
      page.group.preview.create.group.title=Create a new group
      page.group.preview.text=<p>This page shows the database objects that have been selected based on your selection in an external tool. Please review the selection.</p><p>When you''re happy with the result, select a name for the group in the text box and hit the button to create the group.</p>
      page.group.preview.title=Group preview
      page.phenotypes.overview.title=Overview
      page.trials.overview=Overview
      page.trials.phenotype.by.phenotype.coloring.none=No coloring
      page.trials.phenotype.by.phenotype.coloring.treatment=Color by treatment
      page.trials.phenotype.by.phenotype.coloring.dataset=Color by dataset
      general.filename=Filename
      d3.alert.select.filename=Please select a filename
      page.phenotypes.matrix.select.group.phenotype=Please select at least one phenotype and at least one group.
      page.phenotypes.matrix.select.at.most=Please select at most {0,number} phenotypes.
      page.phenotypes.matrix.select.at.most[one]=Please select at most 1 phenotype.
      page.trials.matrix.title=Matrix
      page.genotype.result.download.map=Download map file
      page.cart.button.add.selected=Mark selected items
      page.cart.button.remove.selected=Unmark selected items
      page.phenotypes.geochart.all.phenotypes=All phenotypes
      page.phenotypes.geochart.title=Map
      column.megaenvironment.id=Id
      column.megaenvironment.size=Size
      page.location.treemap.label.items=Items
      page.location.treemap.label.location=Locations
      general.standard.deviation=Standard deviation
      column.phenotype.id=Id
      column.phenotype.name=Name
      column.phenotype.description=Description
      page.admin.config.insufficient.permissions=You don''t have sufficient permissions to view this page and apply changes.
      notification.admin.config.changes.applied=Changes have been applied successfully. Refresh the page to see changes in action.
      page.admin.settings.gatekeeper.heading=Gatekeeper settings
      page.admin.settings.social.heading=Social media settings
      page.admin.settings.usage.tracking.heading=Usage tracking
      page.admin.settings.template.heading=Theme template settings
      page.admin.advanced.heading=Advanced settings
      page.admin.warning=These settings will majorly influence the way Germinate works. Please only change them if you know what you are doing!
      page.admin.button.save.changes=Save changes
      general.confirm=Confirm
      general.copy=Copy
      page.admin.alert.confirm.changes=Are you sure you want to save the changes?
      menu.menu=Menu
      menu.germinate.info=about germinate
      page.accessions.browse.download.selected.accessions=Marked accessions
      notification.accessions.export.mark.at.least.one=Please mark at least one accession.
      contact.us.message=Contact us: {0}
      page.cart.button.add.page=Mark items on page
      page.cart.button.remove.page=Unmark items on page
      widget.pager.page.first=Go to first page
      widget.pager.page.previous=Go to previous page
      widget.pager.page.next=Go to next page
      widget.pager.page.last=Go to last page
      widget.table.filter.title=Toggle filtering
      general.range.from=From
      general.range.to=To
      notification.exception.flapjack=Flapjack could not create the required file.
      page.geographic.search.polygon.text=<p>The map below allows you to select a region by drawing a polygon around it. Once you''re happy with the selection, hit the "Continue" button to get the collecting sites within this polygon.</p><p>You can adjust each corner point of the polygon by dragging it. It''s also possible to add new corner points in between two existing points by dragging the semi-transparent circle.</p><p>Right-click a polygon to remove it from the map.</p>

    - Change the "entry-point" attribute in your "Germinate.gwt.xml" file to:
      <entry-point class="jhi.germinate.client.ModuleCore" />

    - Create SVG versions of "logo.png" and "crop.png" and place them in the same folder.

    - Apache Tomcat 7.0.28 or above is now required

    - Identify the listener section in your web.xml. Change the content of the "listener-class" to:

      <listener-class>jhi.germinate.server.util.ApplicationListener</listener-class>

    - Identify the filter section in your web.xml. Replace the existing filters with the following filters:

      <!-- Add a Filter that takes care of IE header -->
      <filter-mapping>
        <filter-name>HeaderFilter</filter-name>
        <url-pattern />
      </filter-mapping>

      <!-- Add a Filter that forces the browser NOT to cache .nocache files -->
      <filter-mapping>
        <filter-name>GWTCacheControlFilter</filter-name>
        <url-pattern />
      </filter-mapping>

    - Delete all <servlet> and <servlet-mapping> entries from your web.xml file.

    - New property available in "config.properties":

      Germinate.AccessionDisplayColumn=<COLUMN FROM `germinatebase` TABLE>

      This property is used to determine the main attribute of an accession that is used when "naming" the accession, i.e. whenever a name is displayed, the value of this column will be used.

    - Run this against the database:

      ALTER TABLE `datasets`
      ADD COLUMN `contact` varchar(255);
      
      CREATE TABLE IF NOT EXISTS `treatments` (
        `id`  int(11) NOT NULL AUTO_INCREMENT,
        `name`  varchar(255) NOT NULL,
        `description`  varchar(255) NULL,
        `created_on`  datetime NULL,
        `updated_on`  timestamp NULL ON UPDATE CURRENT_TIMESTAMP,
        PRIMARY KEY (`id`)
      );

      ALTER TABLE `phenotypedata`
      ADD COLUMN `location_id` INT(11),
      ADD COLUMN `treatment_id` INT(11),
      ADD COLUMN `trialseries_id` INT(11);

      ALTER TABLE `phenotypedata`
      ADD CONSTRAINT `phenotypes_ibfk_locations` FOREIGN KEY (`location_id`) REFERENCES `locations`(`id`) ON UPDATE CASCADE ON DELETE SET NULL,
      ADD CONSTRAINT `phenotypes_ibfk_treatment` FOREIGN KEY (`treatment_id`) REFERENCES `treatments`(`id`) ON UPDATE CASCADE ON DELETE SET NULL,
      ADD CONSTRAINT `phenotypes_ibfk_trialseries` FOREIGN KEY (`trialseries_id`) REFERENCES `trialseries`(`id`) ON UPDATE CASCADE ON DELETE SET NULL;

      ALTER TABLE `phenotypedata`
      ADD INDEX `trials_query_index` (`phenotype_id`, `germinatebase_id`, `location_id`, `trialseries_id`, `recording_date`, `treatment_id`, `dataset_id`, `phenotype_value`) USING BTREE;

      INSERT INTO treatments (name) SELECT DISTINCT(treatment) FROM trialsdata WHERE NOT ISNULL(treatment);

      INSERT INTO phenotypedata (phenotype_id, germinatebase_id, phenotype_value, dataset_id, recording_date, location_id, treatment_id, trialseries_id) (SELECT phenotype_id, germinatebase_id, value, dataset_id, STR_TO_DATE(year, '%Y'), location_id, (SELECT id FROM treatments WHERE treatments.name = treatment), trialseries_id FROM trialsdata);

      DROP TABLE `trialsdata`;

      CREATE TABLE IF NOT EXISTS `pedigreedescriptions` (
        `id` int(11) NOT NULL AUTO_INCREMENT,
        `name` varchar(255) NOT NULL,
        `description` text,
        `author` varchar(255) DEFAULT NULL,
        `created_on` datetime DEFAULT NULL,
        `updated_on` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
        PRIMARY KEY (`id`)
      ) ENGINE=InnoDB DEFAULT CHARSET=utf8;

      CREATE TABLE IF NOT EXISTS `pedigreenotations` (
        `id` int(11) NOT NULL AUTO_INCREMENT,
        `name` varchar(255) NOT NULL,
        `description` text,
        `reference_url` varchar(255) DEFAULT NULL,
        `created_on` datetime DEFAULT NULL,
        `updated_on` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
        PRIMARY KEY (`id`)
      ) ENGINE=InnoDB DEFAULT CHARSET=utf8;

      CREATE TABLE IF NOT EXISTS `pedigreedefinitions` (
        `id` int(11) NOT NULL AUTO_INCREMENT,
        `germinatebase_id` int(11) NOT NULL,
        `pedigreenotation_id` int(11) NOT NULL,
        `definition` text NOT NULL,
        `created_on` datetime DEFAULT NULL,
        `updated_on` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
        PRIMARY KEY (`id`),
        KEY `pedigreedefinitions_ibfk_pedigreenotations` (`pedigreenotation_id`),
        KEY `pedigreedefinitions_ibfk_germinatebase` (`germinatebase_id`),
        CONSTRAINT `pedigreedefinitions_ibfk_germinatebase` FOREIGN KEY (`germinatebase_id`) REFERENCES `germinatebase` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
        CONSTRAINT `pedigreedefinitions_ibfk_pedigreenotations` FOREIGN KEY (`pedigreenotation_id`) REFERENCES `pedigreenotations` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
      ) ENGINE=InnoDB DEFAULT CHARSET=utf8;

      CREATE TABLE IF NOT EXISTS `pedigrees` (
        `id` int(11) NOT NULL AUTO_INCREMENT,
        `germinatebase_id` int(11) NOT NULL,
        `parent_id` int(11) NOT NULL,
        `relationship_type` int(11) DEFAULT NULL,
        `pedigreedescription_id` int(11) NOT NULL,
        `relationship_description` text,
        `created_on` datetime DEFAULT NULL,
        `updated_on` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
        PRIMARY KEY (`id`),
        KEY `pedigrees_ibfk_germinatebase` (`germinatebase_id`),
        KEY `pedigrees_ibfk_germinatebase_parent` (`parent_id`),
        KEY `pedigrees_ibfk_pedigreedescriptions` (`pedigreedescription_id`),
        CONSTRAINT `pedigrees_ibfk_germinatebase` FOREIGN KEY (`germinatebase_id`) REFERENCES `germinatebase` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
        CONSTRAINT `pedigrees_ibfk_germinatebase_parent` FOREIGN KEY (`parent_id`) REFERENCES `germinatebase` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
        CONSTRAINT `pedigrees_ibfk_pedigreedescriptions` FOREIGN KEY (`pedigreedescription_id`) REFERENCES `pedigreedescriptions` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
      ) ENGINE=InnoDB DEFAULT CHARSET=utf8;

      INSERT INTO attributes (name, description, datatype, created_on, updated_on) VALUES ("flowering_season_start", "Start of the flowering season (month number)", "int", NOW(), NOW());
      INSERT INTO attributes (name, description, datatype, created_on, updated_on) VALUES ("growing_season_start", "Start of the growing season (month number)", "int", NOW(), NOW());

      INSERT INTO attributedata (attribute_id, germinatebase_id, value) SELECT * FROM (SELECT id FROM attributes WHERE name = "flowering_season_start") AS attribute_id, (SELECT id, flowering_season_start FROM germinatebase WHERE NOT ISNULL(flowering_season_start)) AS germinatebase;
      INSERT INTO attributedata (attribute_id, germinatebase_id, value) SELECT * FROM (SELECT id FROM attributes WHERE name = "growing_season_start") AS attribute_id, (SELECT id, growing_season_start FROM germinatebase WHERE NOT ISNULL(growing_season_start)) AS germinatebase;

      ALTER TABLE `germinatebase`
      DROP COLUMN `old_name`,
      DROP COLUMN `sample_level`,
      DROP COLUMN `parent_id`,
      DROP COLUMN `growth_habit`,
      DROP COLUMN `collector`,
      DROP COLUMN `year_identified`,
      DROP COLUMN `month_identified`,
      DROP COLUMN `day_of_year`,
      DROP COLUMN `flowering_season_start`,
      DROP COLUMN `growing_season_start`;

      CREATE TABLE `biologicalstatus` (
        `id` int(11) NOT NULL AUTO_INCREMENT,
        `sampstat` varchar(255) NOT NULL COMMENT 'previoulsy known as sampstat',
        `created_on` datetime DEFAULT NULL,
        `updated_on` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
        PRIMARY KEY (`id`)
      ) ENGINE=InnoDB AUTO_INCREMENT=1000 DEFAULT CHARSET=latin1;

      INSERT INTO `biologicalstatus` VALUES ('100', 'Wild', null, NOW());
      INSERT INTO `biologicalstatus` VALUES ('110', 'Natural', null, NOW());
      INSERT INTO `biologicalstatus` VALUES ('120', 'Semi-natural/wild', null, NOW());
      INSERT INTO `biologicalstatus` VALUES ('130', 'Semi-natural/sown', null, NOW());
      INSERT INTO `biologicalstatus` VALUES ('200', 'Weedy', null, NOW());
      INSERT INTO `biologicalstatus` VALUES ('300', 'Traditional cultivar/landrace', null, NOW());
      INSERT INTO `biologicalstatus` VALUES ('400', 'Breeding/research material', null, NOW());
      INSERT INTO `biologicalstatus` VALUES ('410', 'Breeder''s line', null, NOW());
      INSERT INTO `biologicalstatus` VALUES ('411', 'Synthetic population', null, NOW());
      INSERT INTO `biologicalstatus` VALUES ('412', 'Hybrid', null, NOW());
      INSERT INTO `biologicalstatus` VALUES ('413', 'Founder stock/base population', null, NOW());
      INSERT INTO `biologicalstatus` VALUES ('414', 'Inbred line (parent of hybrid cultivar)', null, NOW());
      INSERT INTO `biologicalstatus` VALUES ('415', 'Segregating population', null, NOW());
      INSERT INTO `biologicalstatus` VALUES ('416', 'Clonal selection', null, NOW());
      INSERT INTO `biologicalstatus` VALUES ('420', 'Genetic stock', null, NOW());
      INSERT INTO `biologicalstatus` VALUES ('421', 'Mutant (e.g. induced/inserion mutants, tilling populations)', null, NOW());
      INSERT INTO `biologicalstatus` VALUES ('422', 'Cytogenic stocks (e.g. chromosome addition/substitution, aneuploids, amphiploids)', null, NOW());
      INSERT INTO `biologicalstatus` VALUES ('423', 'Other genetic stocks (e.g. mapping populations)', null, NOW());
      INSERT INTO `biologicalstatus` VALUES ('500', 'Advanced or improved cultivar (conventional breeding methods)', null, NOW());
      INSERT INTO `biologicalstatus` VALUES ('600', 'GMO (by genetic engineering)', null, NOW());
      INSERT INTO `biologicalstatus` VALUES ('999', 'Other', null, NOW());

      ALTER TABLE `germinatebase` ADD CONSTRAINT `germinatebase_ibfk_biologicalstatus` FOREIGN KEY (`biologicalstatus_id`) REFERENCES `biologicalstatus` (`id`) ON DELETE NO ACTION ON UPDATE CASCADE;

      CREATE TABLE `collectingsources` (
        `id` int(11) NOT NULL AUTO_INCREMENT,
        `collsrc` varchar(255) NOT NULL DEFAULT '' COMMENT 'also known as collsrc',
        `created_on` datetime DEFAULT NULL,
        `updated_on` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
        PRIMARY KEY (`id`)
      ) ENGINE=InnoDB AUTO_INCREMENT=100 DEFAULT CHARSET=latin1;

      INSERT INTO `collectingsources` VALUES ('10', 'Wild habitat', null, NOW());
      INSERT INTO `collectingsources` VALUES ('11', 'Forest or woodland', null, NOW());
      INSERT INTO `collectingsources` VALUES ('12', 'Shrubland', null, NOW());
      INSERT INTO `collectingsources` VALUES ('13', 'Grassland', null, NOW());
      INSERT INTO `collectingsources` VALUES ('14', 'Desert or tundra', null, NOW());
      INSERT INTO `collectingsources` VALUES ('15', 'Aquatic habitat', null, NOW());
      INSERT INTO `collectingsources` VALUES ('20', 'Farm or cultivated habitat', null, NOW());
      INSERT INTO `collectingsources` VALUES ('21', 'Field', null, NOW());
      INSERT INTO `collectingsources` VALUES ('22', 'Orchard', null, NOW());
      INSERT INTO `collectingsources` VALUES ('23', 'Backyard, kitchen or home garden (urban, peri-urban or rural)', null, NOW());
      INSERT INTO `collectingsources` VALUES ('24', 'Fallow land', null, NOW());
      INSERT INTO `collectingsources` VALUES ('25', 'Pasture', null, NOW());
      INSERT INTO `collectingsources` VALUES ('26', 'Farm store', null, NOW());
      INSERT INTO `collectingsources` VALUES ('27', 'Threshing floor', null, NOW());
      INSERT INTO `collectingsources` VALUES ('28', 'Park', null, NOW());
      INSERT INTO `collectingsources` VALUES ('30', 'Market or shop', null, NOW());
      INSERT INTO `collectingsources` VALUES ('40', 'Institute, Experimental station, Research organization, Genebank', null, NOW());
      INSERT INTO `collectingsources` VALUES ('50', 'Seed company', null, NOW());
      INSERT INTO `collectingsources` VALUES ('60', 'Weedy, disturbed or ruderal habitat', null, NOW());
      INSERT INTO `collectingsources` VALUES ('61', 'Roadside', null, NOW());
      INSERT INTO `collectingsources` VALUES ('62', 'Field margin', null, NOW());
      INSERT INTO `collectingsources` VALUES ('99', 'Other (Elaborate in REMARKS field)', null, NOW());

      ALTER TABLE `germinatebase`
      CHANGE COLUMN `collsrc` `collsrc_id`  int(11) NULL DEFAULT NULL AFTER `biologicalstatus_id`;

      ALTER TABLE `germinatebase` ADD CONSTRAINT `germinatebase_ibfk_collectingsource` FOREIGN KEY (`collsrc_id`) REFERENCES `collectingsources` (`id`) ON DELETE NO ACTION ON UPDATE CASCADE;

      ALTER TABLE `germinatebase`
      ADD COLUMN `breeder_id`  int(11) NULL AFTER `institution_id`;

      ALTER TABLE `germinatebase` ADD CONSTRAINT `germinatebase_ibfk_breeder` FOREIGN KEY (`breeder_id`) REFERENCES `institutions` (`id`) ON DELETE NO ACTION ON UPDATE CASCADE;

      ALTER TABLE `markers`
      DROP COLUMN `other_name`,
      DROP COLUMN `close_index`,
      DROP COLUMN `32_unigene`,
      DROP COLUMN `mapped`,
      DROP COLUMN `copy_number`;

      CREATE TABLE `synonymtypes` (
        `id` int(11) NOT NULL AUTO_INCREMENT,
        `target_table` varchar(255) NOT NULL,
        `name` varchar(255) NOT NULL,
        `description` varchar(255) DEFAULT NULL,
        `created_on` datetime DEFAULT NULL,
        `updated_on` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
        PRIMARY KEY (`id`)
      ) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=latin1;

      INSERT INTO `synonymtypes` VALUES ('1', 'germinatebase', 'Accessions', 'Accession synonyms', null, NOW());
      INSERT INTO `synonymtypes` VALUES ('2', 'markers', 'Markers', 'Marker synonyms', null, NOW());

      CREATE TABLE `synonyms` (
        `id` int(11) NOT NULL AUTO_INCREMENT,
        `foreign_id` int(11) NOT NULL,
        `synonymtype_id` int(11) NOT NULL,
        `synonym` varchar(255) NOT NULL,
        `created_on` datetime DEFAULT NULL,
        `updated_on` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
        PRIMARY KEY (`id`),
        KEY `synonyms_ibfk_synonymtypes` (`synonymtype_id`),
        CONSTRAINT `synonyms_ibfk_synonymtypes` FOREIGN KEY (`synonymtype_id`) REFERENCES `synonymtypes` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
      ) ENGINE=InnoDB DEFAULT CHARSET=latin1;

      ALTER TABLE `datasets` MODIFY `description` text NOT NULL,
                             MODIFY `source_file` varchar(255) NULL;

      DROP TABLE IF EXISTS `groupdatasets`;