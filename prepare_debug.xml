<!--
  ~  Copyright 2017 Sebastian Raubach and Paul Shaw from the
  ~  Information and Computational Sciences Group at JHI Dundee
  ~
  ~  Licensed under the Apache License, Version 2.0 (the "License");
  ~  you may not use this file except in compliance with the License.
  ~  You may obtain a copy of the License at
  ~
  ~      http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~  Unless required by applicable law or agreed to in writing, software
  ~  distributed under the License is distributed on an "AS IS" BASIS,
  ~  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~  See the License for the specific language governing permissions and
  ~  limitations under the License.
  -->

<project name="ProjectBuild" basedir="." default="start_debug">

	<property name="src.dir" value="src" />
	<property name="build.dir" value="war" />
	<property file="build-dev.properties" />

	<!-- Check if a browser optimization is disabled -->
	<condition property="noBrowserOpt">
		<or>
			<equals arg1="${settings.browseropt}" arg2="" />
			<equals arg1="${settings.browseropt}" arg2="false" />
		</or>
	</condition>

	<!-- First, make sure there are no leftovers from the previous build -->
	<target name="delete_old_stuff" description="Deletes all the old files of the previously compiled Germinate instance">
		<delete failonerror="false" verbose="true" quiet="true">
			<fileset dir="${src.dir}/jhi/germinate/client/i18n" includes="**/*.properties" />
			<fileset dir="${src.dir}/jhi/germinate/client/gringlobal/i18n" includes="**/*.properties" />
		</delete>

		<!-- Delete old config files -->
		<delete failonerror="false" verbose="true" quiet="true" file="${build.dir}/WEB-INF/web.xml" />
		<delete failonerror="false" verbose="true" quiet="true" file="${src.dir}/jhi/germinate/Germinate.gwt.xml" />
		<delete failonerror="false" verbose="true" quiet="true" file="${src.dir}/jhi/germinate/client/page/login/registration/registration-agreement*.html" />
	</target>

	<!-- Copy the gwt.xml file without browser optimization -->
	<target name="copy_no_browser_opt_xml" description="Copy the gwt.xml file without browser optimization" if="noBrowserOpt">
		<replace file="${src.dir}/jhi/germinate/Germinate.gwt.xml" token="${settings.browseropt.placeholder}" value="" failOnNoReplacements="true" />
		<echo level="info" message="BROWSER OPTIMIZATION DISABLED" />
	</target>

	<!-- Copy the gwt.xml file with browser optimization -->
	<target name="copy_browser_opt_xml" description="Copy the gwt.xml file with browser optimization" unless="noBrowserOpt">
		<replace file="${src.dir}/jhi/germinate/Germinate.gwt.xml" token="${settings.browseropt.placeholder}" value="&lt;set-property name=&quot;user.agent&quot; value=&quot;${settings.browseropt}&quot;/&gt;" failOnNoReplacements="true" />
		<echo level="info" message="BROWSER OPTIMIZATION ENABLED" />
	</target>

	<!-- Then copy the instance specific files (i18n) to the place where the debug mode needs them to be -->
	<target name="copy_files" depends="delete_old_stuff" description="Copies the download and language files for this instance of germinate to the i18n folder">
		<copy todir="${src.dir}/jhi/germinate/client/i18n" overwrite="true" failonerror="true" verbose="true">
			<fileset dir="${instance.files}/i18n" includes="**/*.properties" excludes="**/config.properties" />
		</copy>
		<copy todir="./" overwrite="true" failonerror="true" verbose="true">
			<fileset dir="${instance.files}" includes="**/config.properties" />
		</copy>
		<copy file="${instance.files}/web.xml" tofile="${build.dir}/WEB-INF/web.xml" overwrite="true" failonerror="true" verbose="true" />

		<copy file="${instance.files}/Germinate.gwt.xml" tofile="${src.dir}/jhi/germinate/Germinate.gwt.xml" overwrite="true" failonerror="true" verbose="true" />

		<copy todir="${src.dir}/jhi/germinate/client/page/login/registration" overwrite="true" failonerror="true" verbose="true">
			<fileset dir="${instance.files}/template" includes="**/registration-agreement*.html" />
		</copy>
	</target>

	<target name="start_debug" depends="copy_files, copy_browser_opt_xml, copy_no_browser_opt_xml">

	</target>
</project>